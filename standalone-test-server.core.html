<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>standalone-test-server.core documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Standalone-test-server 0.6.2-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>standalone-test-server</span></div></div></li><li class="depth-2 current"><a href="standalone-test-server.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="standalone-test-server.core.html#var-recording-endpoint"><div class="inner"><span>recording-endpoint</span></div></a></li><li class="depth-1"><a href="standalone-test-server.core.html#var-recording-requests"><div class="inner"><span>recording-requests</span></div></a></li><li class="depth-1"><a href="standalone-test-server.core.html#var-recording-responses"><div class="inner"><span>recording-responses</span></div></a></li><li class="depth-1"><a href="standalone-test-server.core.html#var-recording-traffic"><div class="inner"><span>recording-traffic</span></div></a></li><li class="depth-1"><a href="standalone-test-server.core.html#var-requests-count.3F"><div class="inner"><span>requests-count?</span></div></a></li><li class="depth-1"><a href="standalone-test-server.core.html#var-requests-meet.3F"><div class="inner"><span>requests-meet?</span></div></a></li><li class="depth-1"><a href="standalone-test-server.core.html#var-requests-min-count.3F"><div class="inner"><span>requests-min-count?</span></div></a></li><li class="depth-1"><a href="standalone-test-server.core.html#var-requests-quiescent"><div class="inner"><span>requests-quiescent</span></div></a></li><li class="depth-1"><a href="standalone-test-server.core.html#var-responses-count.3F"><div class="inner"><span>responses-count?</span></div></a></li><li class="depth-1"><a href="standalone-test-server.core.html#var-responses-meet.3F"><div class="inner"><span>responses-meet?</span></div></a></li><li class="depth-1"><a href="standalone-test-server.core.html#var-responses-min-count.3F"><div class="inner"><span>responses-min-count?</span></div></a></li><li class="depth-1"><a href="standalone-test-server.core.html#var-responses-quiescent"><div class="inner"><span>responses-quiescent</span></div></a></li><li class="depth-1"><a href="standalone-test-server.core.html#var-standalone-server"><div class="inner"><span>standalone-server</span></div></a></li><li class="depth-1"><a href="standalone-test-server.core.html#var-traffic-count.3F"><div class="inner"><span>traffic-count?</span></div></a></li><li class="depth-1"><a href="standalone-test-server.core.html#var-traffic-meets.3F"><div class="inner"><span>traffic-meets?</span></div></a></li><li class="depth-1"><a href="standalone-test-server.core.html#var-traffic-min-count.3F"><div class="inner"><span>traffic-min-count?</span></div></a></li><li class="depth-1"><a href="standalone-test-server.core.html#var-traffic-quiescent"><div class="inner"><span>traffic-quiescent</span></div></a></li><li class="depth-1"><a href="standalone-test-server.core.html#var-with-standalone-server"><div class="inner"><span>with-standalone-server</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">standalone-test-server.core</h2><div class="doc"><pre class="plaintext">Provides a ring handler that can record received requests.
</pre></div><div class="public anchor" id="var-recording-endpoint"><h3>recording-endpoint</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Deprecated synonym for `recording-requests`
</pre></div><div class="src-link"><a href="http://github.com/Mayvenn/standalone-test-server/blob/master/src/standalone_test_server/core.clj#L141">view source</a></div></div><div class="public anchor" id="var-recording-requests"><h3>recording-requests</h3><div class="usage"><code>(recording-requests &amp; args)</code></div><div class="doc"><pre class="plaintext">Like `recording-traffic` but the first item in the returned tuple is only the
`requests`.

If you need to ensure a condition of the requests-atom is satisfied before
deref-ing it, use `requests-meet?`, `requests-count?` or a related helper.

Example invocations:
;; Waits up to 1000ms for a single request
(let [[requests handler] (recording-requests)]
  (is (requests-meet? requests first {:timeout 1000}))
  (first @requests))

;; Waits up to 1000ms for two requests
(let [[requests handler] (recording-requests)]
  (is (requests-meet? requests second {:timeout 1000}))
  (take 2 @requests))</pre></div><div class="src-link"><a href="http://github.com/Mayvenn/standalone-test-server/blob/master/src/standalone_test_server/core.clj#L120">view source</a></div></div><div class="public anchor" id="var-recording-responses"><h3>recording-responses</h3><div class="usage"><code>(recording-responses &amp; args)</code></div><div class="doc"><pre class="plaintext">Like `recording-traffic` but the first item in the returned tuple is only the
`responses`.

If you need to ensure a condition of the responses-atom is satisfied before
deref-ing it, use `responses-meet?`, `responses-count?` or a related helper.

Example invocations:
;; Waits up to 1000ms for a single response
(let [[responses handler] (recording-responses)]
  (is (responses-meet? responses first {:timeout 1000}))
  (first @responses))

;; Waits up to 1000ms for two responses
(let [[responses handler] (recording-responses)]
  (is (responses-meet? responses second {:timeout 1000}))
  (take 2 @responses))</pre></div><div class="src-link"><a href="http://github.com/Mayvenn/standalone-test-server/blob/master/src/standalone_test_server/core.clj#L143">view source</a></div></div><div class="public anchor" id="var-recording-traffic"><h3>recording-traffic</h3><div class="usage"><code>(recording-traffic &amp; [{:keys [handler], :or {handler default-handler}}])</code></div><div class="doc"><pre class="plaintext">Creates a ring handler that can record the traffic that flows through it.

Options:
handler  The handler for recording-traffic to wrap. Defaults to
         a handler that returns status 200 with an empty body.

Returns:
[{:requests  requests-atom
  :responses responses-atom}
 recording-handler]

The requests-atom contains a vector of requests received by the
recording-handler. Each item in the responses-atom will be a map of the
`request` and its corresponding `response`. If the handler is slow, items will
show up in the requests-atom before showing up in the responses-atom.

The requests are standard ring requests except that the :body will be a string
instead of InputStream.

Example invocations:
;; Returns a 404 response to the http client that hits this handler
(recording-traffic {:handler (constantly {:status 404 :headers {}})})

See `with-standalone-server` for an example of how to use `recording-traffic`
with a `standalone-server`.</pre></div><div class="src-link"><a href="http://github.com/Mayvenn/standalone-test-server/blob/master/src/standalone_test_server/core.clj#L76">view source</a></div></div><div class="public anchor" id="var-requests-count.3F"><h3>requests-count?</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Synonym for traffic-count?, but makes tests more legible
</pre></div><div class="src-link"><a href="http://github.com/Mayvenn/standalone-test-server/blob/master/src/standalone_test_server/core.clj#L68">view source</a></div></div><div class="public anchor" id="var-requests-meet.3F"><h3>requests-meet?</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Synonym for traffic-meets?, but makes tests more legible
</pre></div><div class="src-link"><a href="http://github.com/Mayvenn/standalone-test-server/blob/master/src/standalone_test_server/core.clj#L67">view source</a></div></div><div class="public anchor" id="var-requests-min-count.3F"><h3>requests-min-count?</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Synonym for traffic-min-count?, but makes tests more legible
</pre></div><div class="src-link"><a href="http://github.com/Mayvenn/standalone-test-server/blob/master/src/standalone_test_server/core.clj#L69">view source</a></div></div><div class="public anchor" id="var-requests-quiescent"><h3>requests-quiescent</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Synonym for traffic-quiescent, but makes tests more legible
</pre></div><div class="src-link"><a href="http://github.com/Mayvenn/standalone-test-server/blob/master/src/standalone_test_server/core.clj#L70">view source</a></div></div><div class="public anchor" id="var-responses-count.3F"><h3>responses-count?</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Synonym for traffic-count?, but makes tests more legible
</pre></div><div class="src-link"><a href="http://github.com/Mayvenn/standalone-test-server/blob/master/src/standalone_test_server/core.clj#L72">view source</a></div></div><div class="public anchor" id="var-responses-meet.3F"><h3>responses-meet?</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Synonym for traffic-meets?, but makes tests more legible
</pre></div><div class="src-link"><a href="http://github.com/Mayvenn/standalone-test-server/blob/master/src/standalone_test_server/core.clj#L71">view source</a></div></div><div class="public anchor" id="var-responses-min-count.3F"><h3>responses-min-count?</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Synonym for traffic-min-count?, but makes tests more legible
</pre></div><div class="src-link"><a href="http://github.com/Mayvenn/standalone-test-server/blob/master/src/standalone_test_server/core.clj#L73">view source</a></div></div><div class="public anchor" id="var-responses-quiescent"><h3>responses-quiescent</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Synonym for traffic-quiescent, but makes tests more legible
</pre></div><div class="src-link"><a href="http://github.com/Mayvenn/standalone-test-server/blob/master/src/standalone_test_server/core.clj#L74">view source</a></div></div><div class="public anchor" id="var-standalone-server"><h3>standalone-server</h3><div class="usage"><code>(standalone-server handler &amp; [opts])</code></div><div class="doc"><pre class="plaintext">Wrapper to start a standalone server through ring-jetty. Takes a ring handler
and if desired, options to pass through to run-jetty.

Example:
(standalone-server handler {:port 4335})</pre></div><div class="src-link"><a href="http://github.com/Mayvenn/standalone-test-server/blob/master/src/standalone_test_server/core.clj#L164">view source</a></div></div><div class="public anchor" id="var-traffic-count.3F"><h3>traffic-count?</h3><div class="usage"><code>(traffic-count? traffic exact-count)</code><code>(traffic-count? traffic exact-count options)</code></div><div class="doc"><pre class="plaintext">Convenience for calling (traffic-meets? traffic-atom #(= exact-count (count %)) options)
</pre></div><div class="src-link"><a href="http://github.com/Mayvenn/standalone-test-server/blob/master/src/standalone_test_server/core.clj#L42">view source</a></div></div><div class="public anchor" id="var-traffic-meets.3F"><h3>traffic-meets?</h3><div class="usage"><code>(traffic-meets? traffic pred)</code><code>(traffic-meets? traffic pred {:keys [timeout], :or {timeout default-timeout}})</code></div><div class="doc"><pre class="plaintext">Blocks until the given traffic-atom satisfies a predicate or the timeout has
been reached.

Returns true or false respectively.

The predicate function takes the state of the traffic-atom as the only argument. It is
tested after every change to the traffic.

Also note that the predicate function may be called on multiple threads simultaneously.

;; Reports whether traffic-atom has at least 2 items before 3 seconds have elapsed.
(traffic-meets? traffic-atom #(&lt;= 2 (count %)) {:timeout 3000})
</pre></div><div class="src-link"><a href="http://github.com/Mayvenn/standalone-test-server/blob/master/src/standalone_test_server/core.clj#L15">view source</a></div></div><div class="public anchor" id="var-traffic-min-count.3F"><h3>traffic-min-count?</h3><div class="usage"><code>(traffic-min-count? traffic min-count)</code><code>(traffic-min-count? traffic min-count options)</code></div><div class="doc"><pre class="plaintext">Convenience for calling (traffic-meets? traffic-atom #(&lt;= min-count (count %)) options)
</pre></div><div class="src-link"><a href="http://github.com/Mayvenn/standalone-test-server/blob/master/src/standalone_test_server/core.clj#L49">view source</a></div></div><div class="public anchor" id="var-traffic-quiescent"><h3>traffic-quiescent</h3><div class="usage"><code>(traffic-quiescent traffic)</code><code>(traffic-quiescent traffic {:keys [for-ms], :or {for-ms default-timeout}})</code></div><div class="doc"><pre class="plaintext">Blocks until the given traffic traffic has stopped growing for `for-ms`

Returns nil.
</pre></div><div class="src-link"><a href="http://github.com/Mayvenn/standalone-test-server/blob/master/src/standalone_test_server/core.clj#L56">view source</a></div></div><div class="public anchor" id="var-with-standalone-server"><h3>with-standalone-server</h3><h4 class="type">macro</h4><div class="usage"><code>(with-standalone-server bindings &amp; body)</code></div><div class="doc"><pre class="plaintext">A convenience macro to ensure a standalone-server is stopped.

Example with standalone-server and recording-requests:
(let [[requests handler] (recording-requests)]
  (with-standalone-server [server (standalone-server handler)]
    (http/get &quot;<a href="http://localhost:4334/endpoint&quot;)">http://localhost:4334/endpoint&quot;)</a>
    (is (requests-count? requests 1))))</pre></div><div class="src-link"><a href="http://github.com/Mayvenn/standalone-test-server/blob/master/src/standalone_test_server/core.clj#L173">view source</a></div></div></div></body></html>
